# FraudGuard AI

Облачный сервис на основе искусственного интеллекта для обнаружения мошенничества и предотвращения chargeback в реальном времени.

## Основные возможности

### 1. **Превентивное обнаружение мошенничества**
- Анализ транзакций в реальном времени с помощью ML модели (XGBoost)
- Точность обнаружения: **Recall ~98.5%**, **Precision ~83.1%**
- Анализ более 100 параметров транзакции

### 2. **Многоуровневая защита**

#### Этап ДО совершения платежа (профилактика):
- AI-система анализирует сотни параметров транзакции
- Сверка с базами известных мошеннических паттернов
- Блокировка подозрительных операций до их завершения

#### Этап совершения платежа (верификация):
- Интеграция с протоколом 3-D Secure (Verified by VISA, Mastercard SecureCode)
- Автоматические рекомендации по требованию дополнительной верификации
- Анализ рисков для определения необходимости подтверждения

#### Этап ПОСЛЕ совершения платежа (документирование):
- Автоматический сбор доказательств для оспаривания chargeback
- Сохранение трек-номеров доставки, переписки, логов
- Подготовка пакета документов для банка

### 3. **Целевая аудитория**
- **B2B сегмент**: малый и средний бизнес России
- Онлайн-магазины
- Платежные системы
- Финтех-стартапы

## Архитектура проекта

```
antifraud-ml/
│
├── app/                          # Основное приложение
│   ├── __init__.py
│   ├── main.py                   # FastAPI приложение
│   ├── models.py                 # Pydantic модели
│   ├── config.py                 # Конфигурация
│   └── ml/                       # ML модули
│       ├── __init__.py
│       ├── fraud_detector.py    # ML модель обнаружения
│       ├── preprocessor.py       # Предобработка данных
│       └── model_trainer.py     # Обучение модели
│
├── services/                     # Сервисы
│   ├── __init__.py
│   ├── risk_analyzer.py         # Анализ рисков
│   └── evidence_collector.py    # Сбор доказательств
│
├── tests/                        # Тесты
│   ├── __init__.py
│   └── test_api.py              # Тесты API
│
├── data/                         # Данные
│   ├── raw/                     # Исходные данные
│   └── models/                  # Обученные модели
│
├── requirements.txt             # Зависимости
├── Dockerfile                   # Docker образ
├── docker-compose.yml           # Docker Compose конфигурация
├── run.py                       # Скрипт запуска
└── README.md                    # Документация
```

## Быстрый старт

### Установка зависимостей

```bash
pip install -r requirements.txt
```

### Обучение модели

Если у есть датасет с транзакциями (P.S. загружен в ./data/raw/):

```bash
python -m app.ml.model_trainer
```

### Запуск приложения

```bash
# Вариант 1: Через run.py
python run.py

# Вариант 2: Через uvicorn напрямую
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

API будет доступен по адресу: `http://localhost:8000`

### Запуск через Docker

```bash
# Сборка и запуск
docker-compose up -d

# Просмотр логов
docker-compose logs -f fraudguard

# Остановка
docker-compose down
```

## API Endpoints

### 1. Анализ транзакции

**POST** `/api/v1/analyze`

Анализирует транзакцию и возвращает оценку риска мошенничества.

**Пример запроса:**

```json
{
  "type": "TRANSFER",
  "amount": 150000.0,
  "nameOrig": "C123456789",
  "oldbalanceOrg": 200000.0,
  "newbalanceOrig": 50000.0,
  "nameDest": "C987654321",
  "oldbalanceDest": 100000.0,
  "newbalanceDest": 250000.0,
  "ip_address": "192.168.1.1",
  "device_id": "device_12345"
}
```

**Пример ответа:**

```json
{
  "transaction_id": "TXN_1699356000",
  "is_fraud": true,
  "fraud_probability": 0.8523,
  "risk_level": "HIGH",
  "risk_score": 85.23,
  "confidence": 0.92,
  "recommendations": [
    "БЛОКИРОВАТЬ ТРАНЗАКЦИЮ - высокий риск мошенничества",
    "Требуется подтверждение через 3D-Secure",
    "Запросить дополнительную верификацию пользователя"
  ],
  "requires_3d_secure": true,
  "should_block": true,
  "timestamp": "2025-11-07T14:30:00"
}
```

### 2. Пакетный анализ

**POST** `/api/v1/batch-analyze`

Анализирует несколько транзакций одновременно.

### 3. Статистика

**GET** `/api/v1/stats`

Возвращает статистику работы системы.

### 4. Проверка здоровья

**GET** `/health`

Проверка состояния сервиса.

## ML Модель

### Характеристики модели

- **Алгоритм**: XGBoost
- **Recall**: ~98.5% (обнаружение мошеннических транзакций)
- **Precision**: ~83.1%
- **Подход**: Фокус на максимизации recall для минимизации пропущенных случаев мошенничества

### Признаки (Features)

Модель использует следующие признаки:

1. `amount` - сумма транзакции
2. `oldbalanceOrg` - баланс отправителя до транзакции
3. `newbalanceOrig` - баланс отправителя после транзакции
4. `oldbalanceDest` - баланс получателя до транзакции
5. `newbalanceDest` - баланс получателя после транзакции
6. `type_CASH_OUT` - флаг типа транзакции
7. `type_TRANSFER` - флаг типа транзакции
8. `balanceChange_Dest` - изменение баланса получателя
9. `fraud_share` - доля мошенничества в данном ценовом диапазоне

### Feature Engineering

- **One-hot encoding** для типов транзакций
- **Логарифмическое биннирование** сумм транзакций
- **Расчет изменения балансов**
- **Random oversampling** для балансировки классов (соотношение 0.5)
- **Удаление выбросов** методом IQR

## Безопасность

- Все данные транзакций шифруются
- Поддержка HTTPS
- Rate limiting для API
- Аутентификация через API keys
- Логирование всех запросов

## Мониторинг

Система собирает следующие метрики:

- Общее количество проанализированных транзакций
- Количество обнаруженных случаев мошенничества
- Процент мошенничества
- Время отклика API
- Уровни риска транзакций

## Тестирование

```bash
# Запуск тестов
pytest tests/

# С покрытием
pytest --cov=app tests/
```
